{% set permissions = get_user_permissions() %}
{% set remark_permission= "mv-remark:create" in permissions or "all" in permissions %}
{% for d in data.data %}
<tr style="text-align: center;">
  <td class="text-bold-500">
    {{d.product_name}}
    {%- set product_env=envs.get(d.environment_id) %}
    {%if product_env %}
    <span class="badge bg-{%if product_env.name == 'production'%}success{%else%}warning{%endif%}">
      {{product_env.name | title}}
    </span>
    {% endif %}
  </td>
  <td class="text-wrap">{{d.bCritical + d.bHigh + d.bMedium}}</td>
  <td>{{d.tOpen + d.tNew - d.tExemption - d.tOthers}}</a></td>
  <td>{{d.tClosed + d.tExemption + d.tOthers}}</td>
  <td id="remark-{{d.product_id}}">
    {%- set remark_str = remarks.get(d.product_id, "").split("\n") -%}
    {% for rmstr in remark_str %}
    <p class="m-0">{{rmstr}}</p>
    {% endfor %}
  </td>
  {% if remark_permission%}
  <td><a class="btn icon btn-primary"
         data-bs-toggle="modal"
         data-bs-target="#add-remark-modal"
         hx-trigger="click"
         hx-target="#add-remark-modal"
         hx-get="remark?product_id={{d.product_id}}&label=sla-breach"><i class="bi bi-pencil"></i></a></td>
  {%endif%}
</tr>
{% else %}
<tr style="text-align: center;"><td colspan="6" >No Data</td></tr>
{% endfor %}
<nav id="page-controller" hx-swap-oob="innerHTML">
  <ul class="pagination pagination-primary justify-content-end">
    <li class="page-item {%if data.page == 1 %}disabled{%endif%}" >
      <a class="page-link" tabindex="-1" aria-disabled="true"
        hx-get="sla-breach/table?page={{data.page - 1}}">Previous</a>
    </li>
    {% for p in range(1,data.total_page+1)%}
    <li class="page-item {%if data.page == p %} active disabled{%endif%}">
      <a class="page-link" hx-get="sla-breach/table?page={{p}}">{{p}}</a></li>
    {%endfor%}
    <li class="page-item {%if data.page == data.total_page or data.page <= 1%}disabled{%endif%}">
      <a class="page-link" hx-get="sla-breach/table?page={{data.page + 1}}">Next</a>
    </li>
  </ul>
</nav>

<h4 id="month-year-breach" hx-swap-oob="innerHTML">
  {{'{:02d}'.format(month | int) }}/{{year}}
</h4>
