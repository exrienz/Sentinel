{% set title = "Findings" %}
{% set filename = "findings.html" %}
{% extends 'layouts/master.html' %}
{% block styles %}
<link rel="stylesheet" href="/assets/scss/iconly.scss">
<link rel="stylesheet" href="assets/extensions/choices.js/public/assets/styles/choices.css">
{% endblock %}
{% block content %}
<div class="page-heading">
  <h3>{{data.name}}</h3>
  Last Scan Date : {{data.findings.0.last_update | datetime_format("%d-%m-%Y")}}
</div>
<div class="page-content">
  <!--Row1-->
  <section class="row">
    <!-- Card 1 -->
    <div class="col-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon blue mb-2 me-3">
              <!-- Added margin-right -->
              <i class="fa-solid fa-folder-open"></i>
            </div>
            <div>
              <h6 class="text-muted font-semibold">{{product.name}}</h6>
              <h6 class="font-extrabold mb-0">
                <a href="/product/{{product.id}}">{{product.environment.name | title }}</a>
              </h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Card 1 -->
    <div class="col-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon red mb-2 me-3">
              <!-- Added margin-right -->
              <i class="fa-solid fa-shield"></i>
            </div>
            <div>
              <h6 class="text-muted font-semibold">Severity</h6>
              <h6 class="font-extrabold mb-0">{{data.findings.0.severity.value | title }}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Card 2 -->
    <div class="col-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon red mb-2 me-3">
              <!-- Added margin-right -->
              <i class="fa-solid fa-circle-exclamation"></i>
            </div>
            <div>
              <h6 class="text-muted font-semibold">Nessus VPR Score</h6>
              <h6 class="font-extrabold mb-0">{{data.findings.0.vpr_score}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="stats-icon black mb-2 me-3">
              <!-- Added margin-right -->
              <i class="fa-solid fa-spinner"></i>
            </div>
            <div>
              <h6 class="text-muted font-semibold">Status</h6>
              <h6 class="font-extrabold mb-0">{{data.findings.0.status.value | title}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--Eo Row1-->
  <!-- Row2 -->
  <section class="row">
    <div class="col-8">
      <!-- Description Card -->
      <div class="card">
        <div class="card-header">
          <h4>Description</h4>
        </div>
        <div class="card-body">
          <p>{{data.description | safe}}</p>
        </div>
      </div>
      <!-- Solution Card -->
      <div class="card">
        <div class="card-header">
          <h4>Solution</h4>
        </div>
        <div class="card-body">
          {{data.findings.0.remediation}}
        </div>
      </div>
      <!-- Help Button Card -->
      <div class="card">
        <div class="card-body">
          <div class="buttons">
            <a href="#" class="btn icon icon-left btn-primary">
              <i class="fa-solid fa-robot"></i>&nbsp;&nbsp;Unclear? Ask AI for help!
            </a>
          </div>
        </div>
      </div>
      {% for host,findings in findings_dict.items() %}
      {% include "pages/finding/component/affected_host.html" %}
      {% endfor %}
    </div>
    <div class="col-4">
      <!-- ITS Remarks -->
      <div class="card">
        <div class="card-header">
          <h4>ITS Remarks</h4>
        </div>
        <div class="card-body">
          <form action="#" method="get">
            <div class="form-group">
              <label for="name" class="form-label">PIC</label>
              <select class="choices form-select multiple-remove" multiple="multiple">
                <optgroup label="Person in Charge">
                  <option value="Rahmat">Rahmat</option>
                  <option value="Mega">Mega</option>
                  <option value="Abu">Abu</option>
                  <option value="Ali">Ali</option>
                </optgroup>
              </select>
            </div>
            <div class="form-group">
              <label for="birthday" class="form-label">Target Remediation Date</label>
              <input type="date" name="target_date" id="target_date" class="form-control"
                placeholder="Target Remediation Date">
            </div>
            <div class="form-group">
              <label for="birthday" class="form-label">Delay reason</label>
              <input type="text" class="form-control" id="basicInput" placeholder="Delay Reason">
            </div>
            <div class="form-group">
              <label for="birthday" class="form-label">ITS Remark</label>
              <input type="text" class="form-control" id="basicInput" placeholder="Delay Reason">
            </div>
            <div class="form-group" align="right">
              <button type="submit" class="btn btn-primary">Save Remarks</button>
            </div>
          </form>
        </div>
      </div>
      <!-- Start: Comments -->
      <div class="card">
        <div hx-get="{{data.id}}/comments" hx-indicator="#spinner" hx-trigger="load">
          {% include "pages/finding/component/comments.html" %}
        </div>
        <div class="card">
          <form hx-post="{{ data.id }}/comment" hx-swap="beforeend" hx-target="#comments_table_id">
            <div class="card-body">
              <div class="form-group mb-3">
                <label for="exampleFormControlTextarea1" class="form-label">Comment:</label>
                <textarea class="form-control" id="comment_post" name="comment" rows="3"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Post Comment
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- End: Comments -->
  </section>
  <!-- End of Row2 -->
</div>
{% endblock %}
{% block js %}
<script src="/assets/extensions/dayjs/dayjs.min.js"></script>
<script src="/assets/extensions/apexcharts/apexcharts.min.js"></script>
<script src="/assets/static/js/pages/ui-apexchart.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<script src="https://cdn.ckeditor.com/ckeditor5/34.2.0/classic/ckeditor.js"></script>
<script src="/assets/extensions/choices.js/public/assets/scripts/choices.js"></script>
<script src="/assets/static/js/pages/ckeditor.js"></script>
<script src="/assets/static/js/pages/form-element-select.js"></script>
{% endblock %}
