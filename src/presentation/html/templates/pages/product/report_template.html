<!DOCTYPE html>
<!--Based on xhtml2pdf-->
<!--A4: size in pt 595 x 842-->
<html lang="en">
  <head>
    <meta charset="UTF-8" content="text/html">
    <title>{{product.name}} Vulnerability Scanning Report</title>
    <style type="text/css">
          @font-face {
            font-family: Arial
          }

          @page {
            size: A4;
            @frame {
              left: 50pt;
              width: 512pt;
              top: 250pt;
              height: 692pt;
            }
          }

          @page content_page {
            size: A4;
            @frame content_frame {
              left: 50pt;
              width: 512pt;
              top: 50pt;
              height: 692pt;
            }
            @frame footer_frame {
              -pdf-frame-content: footer_content;
              left: 50pt;
              width: 512pt;
              top: 815pt;
              height: 25pt;

            }
          }

          @page graph_summary {
            size: A4;
            @frame {
              left: 50pt;
              width: 512pt;
              top: 50pt;
              height: 150pt;
            }

            @frame {
              left: 50pt;
              width: 256pt;
              top: 200pt;
              height: 602pt;
            }
            @frame {
              left: 306pt;
              width: 256pt;
              top: 200pt;
              height: 602pt;
            }
            @frame footer_frame {
              -pdf-frame-content: footer_content;
              left: 50pt;
              width: 512pt;
              top: 815pt;
              height: 25pt;

            }
          }

          @page finding_page {
            size: A4;
            @frame content_frame {
              left: 50pt;
              width: 512pt;
              top: 30pt;
              height: 732pt;
            }
            @frame footer_frame {
              -pdf-frame-content: footer_content;
              left: 50pt;
              width: 512pt;
              top: 815pt;
              height: 25pt;

            }
          }

          h3 {
            -pdf-outline: false;
          }
    </style>
  </head>

  <body>
    <div style="text-align: center; margin-top: 100px;">
      <img src="./public/assets/static/images/logo/paynet_full.png" width="400px"/>
      <h1>{{product.name}} Vulnerability Scanning Report</h1>
      <p>Environment: {{product.environment.name | title}}</p>
      <p>Date: {{now | datetime_format("%d-%m-%y") }}</p>
      <p>Generated by PayNet Sentinel</p>
    </div>

    <pdf:nexttemplate name="content_page">
    <pdf:nextpage>

    <div>
      <pdf:toc/>
    </div>

    <pdf:nextpage>
    <!--Start::Executive Summary-->
    <div>
      <h1>Executive Summary</h1>
      <p>The Nessus Vulnerability Assessment was conducted from <strong>{{curr_log.log_date | datetime_format("%d-%m-%y") }}</strong> to <strong>{{prev_log.log_date | datetime_format("%d-%m-%y")}}</strong> to identify security weaknesses and compliance gaps within the assessed environment.</p>
      <p>The scan results highlight several key findings, including outdated software, missing patches, potential misconfigurations, and critical vulnerabilities in certain systems. These issues pose risks to the confidentiality, integrity, and availability of the system.</p>
      <h3>Key Findings:</h1>
      <ul>
        <li>Critical vulnerabilities that require immediate remediation</li>
        <li>Missing patches for outdated software versions</li>
        <li>Misconfigurations in security settings and access controls</li>
        <li>Potential risks related to unencrypted communications</li>
      </ul>
      <p>For a more detailed analysis of the findings, please refer to the next page or visit PayNet Sentinel Portal</p>
    </div>
    <!--End::Executive Summary-->

    <!--Start::Finding Summary-->
    <pdf:nexttemplate name="graph_summary">
    <pdf:nextpage>
    <div>
      <h1>Finding Summary</h1>
      <p style="margin-bottom: 20px;">Some AI Summary</p>
      <pdf:nextframe>
      <div>
        <!-- Previous URLs -->
        <div style="margin-top: 40px; display: flex; gap: 20px; justify-content: center;">
          <div style="text-align: center; padding: 10px;">
            <h3>Current Open Vulnerability</h3>
            <img src="{{curr_url.0}}" style="max-width: 300px; margin: 10px;">
          </div>
          <div style="text-align: center; padding: 10px;">
            <h3>Current Vulnerability Count by Status</h3>
            <img src="{{curr_url.1}}" style="max-width: 300px; margin: 10px;">
          </div>

        <pdf:nextframe />

        <!-- Current URLs -->
        <div style="margin-top: 40px; display: flex; gap: 20px; justify-content: center;">
          <div style="text-align: center; padding: 10px;">
            <h3>Current Open Vulnerability</h3>
            <img src="{{curr_url.0}}" style="max-width: 300px; margin: 10px;">
          </div>
          <div style="text-align: center; padding: 10px;">
            <h3>Current Vulnerability Count by Status</h3>
            <img src="{{curr_url.1}}" style="max-width: 300px; margin: 10px;">
          </div>

        </div>

      </div>
    </div>
    <!--End::Finding Summary-->

    <!--Start::Host In Scope-->
    <pdf:nexttemplate name="content_page">
    <pdf:nextpage>
    <div>
      <h1>Hosts/IPs/Components in Scope</h1>
      <table repeat="1" style="border: 1px solid #ddd; text-align: left; padding: 5px;">
        <tr style="font-weight:bold;">
          <th style="width:30px; text-align:center;">#</th>
          <th>Host/IP Address/Components</th>
        </tr>
        {% for host in hosts %}
        <tr>
          <td>{{loop.index}}</td>
          <td>{{host}}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
    <!--End::Host In Scope-->

    <!--Start::Findings-->
    <pdf:nexttemplate name="finding_page">
    <pdf:nextpage>
    {% for finding in findings %}
    <div style="position: absolute;
                top: 10pt;
                left: 10pt;
                width: 100pt;
                height: 25pt;
                background-color: {{finding.severity | findingSeverityMap}};
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: bold;">
      {{finding.severity.value}}
    </div>
      <h3 style="margin-bottom: 10px;">{{finding.name}}</h3>
      <p><b>Description:</b>{{finding.description | safe}}</p>
      <p><b>Solution:</b></p>
      <pre
      style='
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 5px;
      '>
      {{finding.remediation}}
      </pre>
      <p><b>Host/Components:</b></p>
      {% set evidences = evidences_dict.get(finding.id)%}
      {% for ev in evidences %}
      <pre
      style='
      white-space: pre-wrap;
      word-wrap: break-word;
      background-color: #f9f9f9;
      overflow-wrap: break-word;
      border: 1px solid #ddd;
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 10px;
      padding-bottom: 10px;
      '>
        {{ ev.evidence | safe }}
        <br/> ----------------------------------------
        {% for host in ev.hosts %}
          <br/>{{host}}
        {% endfor %}
      </pre>
      {% endfor %}
    </div>
    <pdf:nextpage>
    {% endfor %}
    <div id="footer_content" style="text-align: center;">
      (c) - page <pdf:pagenumber> of <pdf:pagecount>
    </div>
    <!--End::Findings-->

  </body>
</html>
